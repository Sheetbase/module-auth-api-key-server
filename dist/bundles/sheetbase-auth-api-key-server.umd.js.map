{"version":3,"file":"sheetbase-auth-api-key-server.umd.js","sources":["../esm3/lib/auth-api-key.js"],"sourcesContent":["var __assign = (this && this.__assign) || function () {\r\n    __assign = Object.assign || function(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n                t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\r\nfunction loadAPIKeys(options) {\r\n    var apiKeys = {};\r\n    var validApiKeys = options.apiKeys, validKey = options.key;\r\n    if (validKey) {\r\n        apiKeys[validKey] = { title: 'Untitled', value: validKey };\r\n    }\r\n    else if (!!validApiKeys) {\r\n        for (var _i = 0, _a = Object.keys(validApiKeys); _i < _a.length; _i++) {\r\n            var k = _a[_i];\r\n            var apiKey = validApiKeys[k];\r\n            if (apiKey instanceof Object) { // apiKey = an object\r\n                apiKeys[k] = __assign({}, apiKey, { value: k });\r\n            }\r\n            else { // apiKey = string\r\n                apiKeys[k] = { title: apiKey, value: k };\r\n            }\r\n        }\r\n    }\r\n    return apiKeys;\r\n}\r\nexport function middleware(options) {\r\n    if (options === void 0) { options = {}; }\r\n    return function (req, res, next) {\r\n        // 'apiKeys/apiKey' = objects/object (APIKey interface)\r\n        // 'key' = string\r\n        // get key from the request\r\n        var key = req.body.apiKey || req.query.apiKey;\r\n        var apiKeys = loadAPIKeys(options);\r\n        var apiKey = key ? apiKeys[key] : null;\r\n        if (!apiKey) {\r\n            var failure = options.failure;\r\n            if (!!(failure && failure.constructor && failure.call && failure.apply)) {\r\n                return failure(req, res);\r\n            }\r\n            else {\r\n                try {\r\n                    return res.render('errors/403');\r\n                }\r\n                catch (error) {\r\n                    return res.html('<h1>403!</h1><p>Unauthorized.</p>');\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            var trigger = options.trigger;\r\n            if (!!(trigger && trigger.constructor && trigger.call && trigger.apply)) {\r\n                trigger(req, apiKey);\r\n            }\r\n        }\r\n        return next();\r\n    };\r\n}\r\n"],"names":["this"],"mappings":";;;;;;IAAA,IAAI,QAAQ,GAAG,CAACA,SAAI,IAAIA,SAAI,CAAC,QAAQ,KAAK,YAAY;IACtD,IAAI,QAAQ,GAAG,MAAM,CAAC,MAAM,IAAI,SAAS,CAAC,EAAE;IAC5C,QAAQ,KAAK,IAAI,CAAC,EAAE,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,SAAS,CAAC,MAAM,EAAE,CAAC,GAAG,CAAC,EAAE,CAAC,EAAE,EAAE;IAC7D,YAAY,CAAC,GAAG,SAAS,CAAC,CAAC,CAAC,CAAC;IAC7B,YAAY,KAAK,IAAI,CAAC,IAAI,CAAC,EAAE,IAAI,MAAM,CAAC,SAAS,CAAC,cAAc,CAAC,IAAI,CAAC,CAAC,EAAE,CAAC,CAAC;IAC3E,gBAAgB,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;IAC5B,SAAS;IACT,QAAQ,OAAO,CAAC,CAAC;IACjB,KAAK,CAAC;IACN,IAAI,OAAO,QAAQ,CAAC,KAAK,CAAC,IAAI,EAAE,SAAS,CAAC,CAAC;IAC3C,CAAC,CAAC;IACF,SAAS,WAAW,CAAC,OAAO,EAAE;IAC9B,IAAI,IAAI,OAAO,GAAG,EAAE,CAAC;IACrB,IAAI,IAAI,YAAY,GAAG,OAAO,CAAC,OAAO,EAAE,QAAQ,GAAG,OAAO,CAAC,GAAG,CAAC;IAC/D,IAAI,IAAI,QAAQ,EAAE;IAClB,QAAQ,OAAO,CAAC,QAAQ,CAAC,GAAG,EAAE,KAAK,EAAE,UAAU,EAAE,KAAK,EAAE,QAAQ,EAAE,CAAC;IACnE,KAAK;IACL,SAAS,IAAI,CAAC,CAAC,YAAY,EAAE;IAC7B,QAAQ,KAAK,IAAI,EAAE,GAAG,CAAC,EAAE,EAAE,GAAG,MAAM,CAAC,IAAI,CAAC,YAAY,CAAC,EAAE,EAAE,GAAG,EAAE,CAAC,MAAM,EAAE,EAAE,EAAE,EAAE;IAC/E,YAAY,IAAI,CAAC,GAAG,EAAE,CAAC,EAAE,CAAC,CAAC;IAC3B,YAAY,IAAI,MAAM,GAAG,YAAY,CAAC,CAAC,CAAC,CAAC;IACzC,YAAY,IAAI,MAAM,YAAY,MAAM,EAAE;IAC1C,gBAAgB,OAAO,CAAC,CAAC,CAAC,GAAG,QAAQ,CAAC,EAAE,EAAE,MAAM,EAAE,EAAE,KAAK,EAAE,CAAC,EAAE,CAAC,CAAC;IAChE,aAAa;IACb,iBAAiB;IACjB,gBAAgB,OAAO,CAAC,CAAC,CAAC,GAAG,EAAE,KAAK,EAAE,MAAM,EAAE,KAAK,EAAE,CAAC,EAAE,CAAC;IACzD,aAAa;IACb,SAAS;IACT,KAAK;IACL,IAAI,OAAO,OAAO,CAAC;IACnB,CAAC;AACD,IAAO,SAAS,UAAU,CAAC,OAAO,EAAE;IACpC,IAAI,IAAI,OAAO,KAAK,KAAK,CAAC,EAAE,EAAE,OAAO,GAAG,EAAE,CAAC,EAAE;IAC7C,IAAI,OAAO,UAAU,GAAG,EAAE,GAAG,EAAE,IAAI,EAAE;IACrC;IACA;IACA;IACA,QAAQ,IAAI,GAAG,GAAG,GAAG,CAAC,IAAI,CAAC,MAAM,IAAI,GAAG,CAAC,KAAK,CAAC,MAAM,CAAC;IACtD,QAAQ,IAAI,OAAO,GAAG,WAAW,CAAC,OAAO,CAAC,CAAC;IAC3C,QAAQ,IAAI,MAAM,GAAG,GAAG,GAAG,OAAO,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC;IAC/C,QAAQ,IAAI,CAAC,MAAM,EAAE;IACrB,YAAY,IAAI,OAAO,GAAG,OAAO,CAAC,OAAO,CAAC;IAC1C,YAAY,IAAI,CAAC,EAAE,OAAO,IAAI,OAAO,CAAC,WAAW,IAAI,OAAO,CAAC,IAAI,IAAI,OAAO,CAAC,KAAK,CAAC,EAAE;IACrF,gBAAgB,OAAO,OAAO,CAAC,GAAG,EAAE,GAAG,CAAC,CAAC;IACzC,aAAa;IACb,iBAAiB;IACjB,gBAAgB,IAAI;IACpB,oBAAoB,OAAO,GAAG,CAAC,MAAM,CAAC,YAAY,CAAC,CAAC;IACpD,iBAAiB;IACjB,gBAAgB,OAAO,KAAK,EAAE;IAC9B,oBAAoB,OAAO,GAAG,CAAC,IAAI,CAAC,mCAAmC,CAAC,CAAC;IACzE,iBAAiB;IACjB,aAAa;IACb,SAAS;IACT,aAAa;IACb,YAAY,IAAI,OAAO,GAAG,OAAO,CAAC,OAAO,CAAC;IAC1C,YAAY,IAAI,CAAC,EAAE,OAAO,IAAI,OAAO,CAAC,WAAW,IAAI,OAAO,CAAC,IAAI,IAAI,OAAO,CAAC,KAAK,CAAC,EAAE;IACrF,gBAAgB,OAAO,CAAC,GAAG,EAAE,MAAM,CAAC,CAAC;IACrC,aAAa;IACb,SAAS;IACT,QAAQ,OAAO,IAAI,EAAE,CAAC;IACtB,KAAK,CAAC;IACN,CAAC;;;;;;;;;;;;"}